### FoxCM 视频管理系统技术文档  

---

#### **系统名称**  
**FoxCM**  
**版本**：1.0  
**协议**：未声明  
**开发团队**：未标注  
**联系邮箱**：未提供  

---  

### **一、系统概述**  
FoxCM 是基于 Flask 框架开发的轻量级视频内容管理系统，支持用户注册、视频上传、评论互动、播放统计及管理员权限管理。系统采用 JSON 文件存储数据，兼容本地开发与可执行文件打包部署模式，通过模块化设计实现多用户内容管理功能。  

---  

### **二、核心功能**  
1. **用户管理**  
   - 支持用户注册、登录、注销功能，会话通过 Flask Session 管理。  
   - 用户头像上传与存储，支持 JPG/PNG 格式，自动清理旧头像文件。  

2. **视频管理**  
   - 视频文件（MP4/AVI/MOV）与封面（JPG/PNG）上传，UUID 重命名防冲突。  
   - 播放量统计、视频搜索（标题/描述关键词匹配）、用户个人主页展示。  

3. **评论系统**  
   - 登录用户可发表评论，支持评论点赞功能（防重复点赞）。  
   - 评论数据按视频文件分组存储，记录用户 ID、时间戳及点赞列表。  

4. **管理员功能**  
   - 用户与视频批量删除，实时清理关联文件（视频/封面）。  
   - 通过 `is_admin` 字段控制管理员权限。  

5. **部署适配**  
   - 自动创建运行所需的 `data`、`uploads` 目录及初始 JSON 文件。  
   - 支持 `sys.frozen` 检测，兼容 PyInstaller 打包为可执行文件。  

---  

### **三、技术实现**  
1. **数据存储**  
   - **用户数据**：`user.json` 存储用户名、密码哈希（明文存密码需改进）、头像路径。  
   - **视频数据**：`foxcm-sp.json` 记录视频元数据（标题、上传者、播放量等）。  
   - **评论数据**：`comments.json` 按视频文件名建立嵌套字典结构。  

2. **路由设计**  
   ```python  
   # 关键路由示例  
   @app.route('/upload', methods=['GET', 'POST'])  # 视频上传  
   @app.route('/admin')  # 管理后台  
   @app.route('/like_comment', methods=['POST'])  # 点赞功能  
   ```  

3. **安全机制**  
   - 文件上传白名单验证（`allowed_file` 函数）。  
   - 管理员操作前权限检查（`user.get('is_admin')`）。  
   - 敏感操作（删除文件）关联资源清理。  

4. **前端交互**  
   - AJAX 响应处理（`handle_response` 统一封装）。  
   - PWA 支持（注释的 `manifest.json` 与 `sw.js` 路由）。  
   - 模板引擎使用 `render_template` 动态渲染页面。  

---  

### **四、运行配置**  
1. **环境依赖**  
   - Python 3.x  
   - Flask 及其依赖库  
   - 可选 PyInstaller（用于打包）  

2. **启动参数**  
   ```python  
   if __name__ == '__main__':  
       app.run(host='0.0.0.0', port=6544, debug=True)  # 调试模式  
   ```  

3. **目录结构**  
   ```  
   ├── data/                  # JSON 数据库  
   ├── static/                # 静态资源  
   │   ├── uploads/  
   │   │   ├── avatars/       # 用户头像  
   │   │   ├── covers/        # 视频封面  
   │   │   └── videos/        # 视频文件  
   └── templates/             # HTML 模板  
   ```  

---  

### **五、扩展性说明**  
1. **待改进项**  
   - 密码明文存储需替换为哈希加密（如 bcrypt）。  
   - 缺乏分页功能，视频/评论过多时性能下降。  
   - 无视频分类或标签支持。  

2. **定制扩展**  
   - 修改 `ALLOWED_VIDEO_EXTENSIONS` 扩展支持格式。  
   - 通过 `system.json` 可自定义站点标题等配置。  
   - 启用 PWA 需取消注释相关路由并配置 Manifest。  

---  

**备注**：本文档基于DeepSeek代码分析生成，部分功能可能存在实现细节差异。